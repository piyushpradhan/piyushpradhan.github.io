I"Œ<h1 id="learning-from-htb-challenges">Learning from HTB Challenges</h1>

<h1 id="racecar">Racecar</h1>

<p>I had tried this one before but couldnâ€™t solve it, after learning about binary exploitation and writing a few blogs on it I decided to give it another shot.</p>

<p>First things first, I fired up Ghidra and looked at the decompiled code.</p>

<p><img src="https://miro.medium.com/max/1222/1*DaLdIECHNumMbvkzais3_g.png" alt="" />Decompiled code of car_menu() function from Ghidra</p>

<p>There it is, a â€œFormat String Vulnerabilityâ€ in that printf statement. What is a format string vulnerability you ask ? Simply put, it is a printf statement without format specifiers, which allows attackers like us to exploit that by supplying format specifiers like â€œ%pâ€ to leak pointer addresses from the program, by simply providing them in the input.</p>

<p>Now, that I have a way to obtain some information I just needed to figure out what I wanted to extract. Easy right ? The contents of flag.txt file, but for some reason it took me half an hour to figure that out.</p>

<p><img src="https://miro.medium.com/max/1120/0*aVl2-fEoGOAPhljX.gif" alt="" /></p>

<p>Anyway, I noticed that the contents of flag.txt file are being stored in â€œ_streamâ€ variable and that value is printed only when we win the race.</p>

<p><img src="https://miro.medium.com/max/922/1*FDFf5nJ1SsQ6dE1VlGIDQA.png" alt="" /></p>

<p>Weâ€™re asked to give a victory speech after winning the race, thatâ€™s the entry point! I can send tons of â€œ%pâ€, convert the hex into ASCII characters and challenge completed, easyâ€¦ at least thatâ€™s what I thought, but it took a lot more time than what I had expected.</p>

<p>In the screenshot, thereâ€™s that â€œfgetsâ€ statement which clearly states that the value of â€œ_streamâ€, which actually contains the value of flag.txt file, is stored in â€œlocal_3câ€. Ghidra gave me the address of â€œlocal_3câ€ variable, I took it over to gdb to examine the state of the stack right after I provide the malicious input.</p>

<p><img src="https://miro.medium.com/max/1400/1*Wqlb00IiYxVFHGoi70UI7w.png" alt="" /></p>

<p>The address of the â€œlocal_3câ€ variable was 0x00001002, so I set a breakpoint on that address and ran the program. But the program crashed, why ? I still canâ€™t figure it out, if any of you have any idea what happened here, please let me know. After an hour of trying several methods (none of them were finding an alternative to the way breakpoints can be set in gdb) I decided to look at a writeup and guess what I learned that there are other ways to set breakpoints too.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>ged-peda$ break \* (car\_menu+881)
</code></pre></div></div>

<p>Oh, by the way that â€œcar_menu+881â€ came from that particular instruction at 0x00001002.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>gdb-peda$ x/i 0x00001002
</code></pre></div></div>

<p>Now, I just input a bunch of â€œ%pâ€ in the victory speech part, but nothing happened, then I realized I had created an empty flag.txt. So, I put â€œAAAAâ€ inside that file and examined the stack againâ€¦</p>

<p><img src="https://miro.medium.com/max/1400/1*Y5-jMhmJ8o1G7qHj0MMPNA.png" alt="" /></p>

<p>Just to make sure that this wasnâ€™t some coincidence, I changed the contents of flag.txt to â€œBBBB AAAAâ€ and checked again.</p>

<p><img src="https://miro.medium.com/max/1400/1*jE54n6ihz2qeKA6NIpyaaw.png" alt="" /></p>

<p>Yeah, the contents of the flag.txt can actually be read from the stack.</p>

<p>Did the same thing with the server too, provided a bunch of â€œ%pâ€ in the victory speech part and it returned hex!</p>

<p><img src="https://miro.medium.com/max/1400/1*_mIytyQ0ngxJdmd3XpsZeg.png" alt="" /></p>

<p>Put all of that, after removing those (nil) values, into CyberChef to decode it.</p>

<p><img src="https://miro.medium.com/max/1400/1*6E-fxO9hiMOlrgUSPABbhQ.png" alt="" /></p>

<p>And look at that, thereâ€™s something that looks like a flag. Remember the format of HTB flags, â€œHTB{some_text}â€. To convert this string into that pattern, I wrote a simple but horrible C code.</p>

<p><img src="https://miro.medium.com/max/780/1*tNgvn7qlYJ-SNC1h8VaLbw.png" alt="" /><img src="https://miro.medium.com/max/1382/1*66F_3Ut9t-1AUB_AuX_Cog.png" alt="" /></p>

<p>Itâ€™s not very good, but it gets the job done :)</p>
:ET